{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Equipamentos | Sistema EPI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="{% static 'gestao/css/styles.css' %}">
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <div class="user-profile" onclick="toggleSettingsMenu()">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                    <img src="{% static 'path/para/sua-foto.jpg' %}" alt="" class="user-avatar-img">
                </div>
                <div class="user-info">
                    <span class="user-name">Lucas Silva</span>
                    <span class="user-role">Administrador</span>
                    <span class="user-email">email@dominio.com</span>
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
        </div>
    
        <div class="settings-menu" id="settings-menu">
            <ul>
                <li>
                    <a href="#">
                        <i class="fas fa-user-cog"></i>
                        <span>Configurações de Perfil</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-key"></i>
                        <span>Alterar Senha</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="confirmarLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sair</span>
                    </a>
                </li>
            </ul>
        </div>
    
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item">
                    <a href="{% url 'admin_dashboard' %}" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'cadastrar_epi' %}" class="nav-link">
                        <i class="fas fa-hard-hat"></i>
                        <span>Equipamentos</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="{% url 'cadastro_colaboradores' %}" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>Usuários</span>
                        <span class="badge bg-primary">5</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'emprestimo' %}" class="nav-link">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Empréstimos</span>
                        <span class="badge bg-warning">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="confirmarLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sair</span>
                    </a>
                </li>
            </ul>
        </nav>
    
        <div class="sidebar-footer">
            <div class="system-info">
                <i class="fas fa-circle text-success"></i>
                <span>Sistema Online</span>
            </div>
            <div class="version-info">
                v2.1.0
            </div>
        </div>
    </div>
    
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
    function toggleSettingsMenu() {
        const menu = document.getElementById("settings-menu");
        menu.classList.toggle("active");
        
        const icon = document.querySelector(".toggle-icon");
        icon.style.transform = menu.classList.contains("active") ? "rotate(180deg)" : "rotate(0)";
    }
    
    function confirmarLogout() {
        Swal.fire({
            title: 'Tem certeza?',
            text: "Você será desconectado do sistema!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim, sair!',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "/login";
            }
        });
    }
    
    // Para versão mobile - alternar sidebar
    function toggleSidebar() {
        document.querySelector('.sidebar').classList.toggle('active');
    }
    </script>

    <div class="main-content">
        <div class="container-fluid">
            <!-- Cabeçalho da Página -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-0">
                        <i class="fas fa-hard-hat me-2 text-primary"></i>Gestão de Equipamentos
                    </h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Dashboard</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Equipamentos</li>
                        </ol>
                    </nav>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#novoEquipamentoModal">
                    <i class="fas fa-plus me-2"></i>Novo Equipamento
                </button>
            </div>

            <!-- Mensagens do Sistema -->
            {% if messages %}
            <div class="alert-container mb-4">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Abas de Navegação -->
            <ul class="nav nav-tabs mb-4">
                <li class="nav-item">
                    <a class="nav-link active" href="#todos" data-bs-toggle="tab">
                        <i class="fas fa-list me-2"></i>Todos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#disponiveis" data-bs-toggle="tab">
                        <i class="fas fa-check-circle me-2"></i>Disponíveis
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#emprestados" data-bs-toggle="tab">
                        <i class="fas fa-exchange-alt me-2"></i>Emprestados
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#manutencao" data-bs-toggle="tab">
                        <i class="fas fa-tools me-2"></i>Manutenção
                    </a>
                </li>
            </ul>
<style>
            .card.mb-4 {
                width: 90%;
                max-width: 1200px;
                margin-left: auto;
                margin-right: auto;
            }
            
        </style>

            <!-- Card de Filtros e Pesquisa -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="search-container">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="fas fa-search text-muted"></i>
                                    </span>
                                    <input type="text" id="searchInput" class="form-control border-start-0" placeholder="Pesquisar equipamento...">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="filterTipo">
                                <option value="">Todos os tipos</option>
                                <option value="Capacete">Capacete</option>
                                <option value="Luva">Luva</option>
                                <option value="Bota">Bota</option>
                                <option value="Óculos">Óculos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-outline-secondary w-100" id="btnFiltrar">
                                <i class="fas fa-filter me-2"></i>Filtrar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

      <style>
    .tab-content .card {
        width: 90%;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Para garantir que a tabela ocupe todo o espaço disponível */
    .tab-content .card-body .table {
        width: 100%;
    }
</style>

            <!-- Conteúdo das Abas -->
            <div class="tab-content">
                <div class="tab-pane fade show active" id="todos">
                    <!-- Tabela de Equipamentos -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list me-2"></i>Lista de Equipamentos
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Equipamento</th>
                                            <th>Tipo</th>
                                            <th>Status</th>
                                            <th>Última Atualização</th>
                                            <th class="text-end">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaEquipamentos">
                                        {% for equipamento in equipamentos %}
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="equipamento-icon">
                                                        <i class="fas fa-hard-hat"></i>
                                                    </div>
                                                    <div>
                                                        <strong>{{ equipamento.nome }}</strong>
                                                        <div class="text-muted small">#{{ equipamento.id }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>{{ equipamento.tipo }}</td>
                                            <td>
                                                <span class="status-badge status-{{ equipamento.status|lower }}">
                                                    {{ equipamento.status }}
                                                </span>
                                            </td>
                                            <td>{{ equipamento.ultima_atualizacao|date:"d/m/Y H:i" }}</td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <a href="{% url 'editar_equipamento' equipamento.id %}" class="btn btn-sm btn-outline-primary action-btn" title="Editar">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <button class="btn btn-sm btn-outline-danger action-btn" title="Excluir" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" data-id="{{ equipamento.id }}">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </button>
                                                    <a href="#" class="btn btn-sm btn-outline-success action-btn" title="Detalhes">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="text-muted small">
                                    Mostrando <strong>1</strong> a <strong>10</strong> de <strong>{{ equipamentos|length }}</strong> registros
                                </div>
                                <nav aria-label="Page navigation">
                                    <ul class="pagination pagination-sm mb-0">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Anterior</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Próxima</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo das outras abas (similares) -->
                <div class="tab-pane fade" id="disponiveis">...</div>
                <div class="tab-pane fade" id="emprestados">...</div>
                <div class="tab-pane fade" id="manutencao">...</div>
            </div>
        </div>
    </div>

    <!-- Modal Novo Equipamento -->
    <div class="modal fade" id="novoEquipamentoModal" tabindex="-1" aria-labelledby="novoEquipamentoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="novoEquipamentoModalLabel">
                        <i class="fas fa-plus me-2"></i>Novo Equipamento
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="modalEquipamentoForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="modalNome" class="form-label">Nome do Equipamento *</label>
                                <input type="text" class="form-control" id="modalNome" required>
                            </div>
                            <div class="col-md-6">
                                <label for="modalTipo" class="form-label">Tipo de Equipamento *</label>
                                <select class="form-select" id="modalTipo" required>
                                    <option value="">Selecione um tipo</option>
                                    <option value="Capacete">Capacete de Segurança</option>
                                    <option value="Luva">Luvas de Proteção</option>
                                    <option value="Bota">Botas de Segurança</option>
                                    <option value="Óculos">Óculos de Proteção</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="modalNumeroSerie" class="form-label">Número de Série</label>
                                <input type="text" class="form-control" id="modalNumeroSerie">
                            </div>
                            <div class="col-md-6">
                                <label for="modalDataFabricacao" class="form-label">Data de Fabricação</label>
                                <input type="date" class="form-control" id="modalDataFabricacao">
                            </div>
                            <div class="col-md-6">
                                <label for="modalStatus" class="form-label">Status *</label>
                                <select class="form-select" id="modalStatus" required>
                                    <option value="Disponível" selected>Disponível</option>
                                    <option value="Emprestado">Emprestado</option>
                                    <option value="Manutenção">Manutenção</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="modalQuantidade" class="form-label">Quantidade *</label>
                                <input type="number" class="form-control" id="modalQuantidade" value="1" min="1" required>
                            </div>
                            <div class="col-12">
                                <label for="modalObservacoes" class="form-label">Observações</label>
                                <textarea class="form-control" id="modalObservacoes" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="salvarEquipamento">
                        <i class="fas fa-save me-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Exclusão
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir este equipamento? Esta ação não pode ser desfeita.</p>
                    <div class="alert alert-warning mb-0">
                        <i class="fas fa-info-circle me-2"></i>Equipamentos com histórico de empréstimos não podem ser excluídos.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">
                        <i class="fas fa-trash-alt me-2"></i>Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
    <script>
        // Inicialização do Flatpickr para campos de data
        flatpickr("#modalDataFabricacao", {
            dateFormat: "d/m/Y",
            locale: "pt"
        });

        // Evento para excluir um equipamento após confirmação
        document.querySelectorAll('[data-bs-target="#confirmDeleteModal"]').forEach(button => {
            button.addEventListener('click', function() {
                const equipamentoId = this.getAttribute('data-id');
                document.getElementById('confirmDeleteButton').setAttribute('data-id', equipamentoId);
            });
        });

        document.getElementById('confirmDeleteButton').addEventListener('click', function() {
            const equipamentoId = this.getAttribute('data-id');
            // Aqui você adicionaria a lógica para excluir o equipamento
            alert('Equipamento #' + equipamentoId + ' excluído com sucesso!');
            $('#confirmDeleteModal').modal('hide');
        });

        // Filtro de pesquisa
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            document.querySelectorAll('#tabelaEquipamentos tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Filtro por tipo
        document.getElementById('filterTipo').addEventListener('change', function() {
            const tipo = this.value;
            document.querySelectorAll('#tabelaEquipamentos tr').forEach(row => {
                if (!tipo) {
                    row.style.display = '';
                    return;
                }
                const rowTipo = row.querySelector('td:nth-child(2)').textContent.trim();
                row.style.display = rowTipo === tipo ? '' : 'none';
            });
        });
    </script>
</body>
</html>